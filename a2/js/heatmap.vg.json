{
  "data": {"url": "data/metro_train_station/metro_train_station.csv"},
  "params": [
    {
      "name": "selectedYear",
      "value": 2018,
      "bind": {
        "input": "select",
        "options": [2018, 2019, 2020, 2021, 2022],
        "name": "Select Year: "
      }
    }
  ],
  "transform": [
    {
      "filter": "datum.Year == selectedYear"
    },
    {
      "filter": "datum.Stop_line !== 'City Loop'"
    },
    {
      "fold": [
        "Pax_AM_peak",
        "Pax_interpeak",
        "Pax_PM_peak",
        "Pax_PM_late",
        "Pax_pre_AM_peak"
      ],
      "as": ["Time_Band", "Patronage"]
    },
    {
      "aggregate": [
        {"op": "average", "field": "Patronage", "as": "Avg_Patronage"}
      ],
      "groupby": ["Stop_line", "Time_Band"]
    }
  ],
  "mark": "rect",
  "encoding": {
    "x": {
      "field": "Time_Band",
      "type": "ordinal",
      "title": "Time Band",
      "sort": [
        "Pax_pre_AM_peak",
        "Pax_AM_peak",
        "Pax_interpeak",
        "Pax_PM_peak",
        "Pax_PM_late"
      ],
      "axis": {
        "labelExpr": "datum.label == 'Pax_pre_AM_peak' ? 'Pre AM' : datum.label == 'Pax_AM_peak' ? 'AM Peak' : datum.label == 'Pax_interpeak' ? 'Interpeak' : datum.label == 'Pax_PM_peak' ? 'PM Peak' : 'PM Late'",
        "labelAngle":45
      }
    },
    "y": {
      "field": "Stop_line",
      "type": "nominal",
      "title": "Train Line"
    },
    "color": {
      "field": "Avg_Patronage",
      "type": "quantitative",
      "title": "Avg Pax Entries",
      "scale": {"range": "heatmap"}
    },
    "tooltip": [
      {"field": "Stop_line", "title": "Train Line"},
      {"field": "Time_Band", "title": "Time Band"},
      {"field": "Avg_Patronage", "title": "Avg Pax", "format": ","}
    ]
  },
  "title": {
    "text": [
      "Average Weekday Patronage by Train Line and Time Band",
      "(Excluding City Loop stations)"
    ]
  }
}