{
  "$schema": "https://vega.github.io/schema/vega-lite/v6.json",
  "data": {
    "url": "data/monthly_average_patronage_by_day_type_and_by_mode.csv"
  },

  "title": "Annual passenger numbers by transport type (Victoria)",
  "encoding": {
    "x": {"field": "Year", "type": "ordinal", "title": "Year"},
    "y": {
      "aggregate": "sum",
      "field": "Pax_daily",
      "type": "quantitative",
      "title": "Total Passengers (per year)",
      "axis": {"format": "s"}
    },
    "color": {
      "field": "Mode",
      "type": "nominal",
      "title": "Transport Mode",
      "legend": {"title": "Transport Mode"}
    },
    "tooltip": [
      {"field": "Year", "type": "ordinal", "title": "Year"},
      {"field": "Mode", "type": "nominal", "title": "Mode"},
      {
        "aggregate": "sum",
        "field": "Pax_daily",
        "type": "quantitative",
        "title": "Passengers",
        "format": "s"
      }
    ]
  },
  "layer": [
    {
      "params": [
        {
          "name": "mode_selection",
          "select": {"type": "point", "fields": ["Mode"]},
          "bind": "legend"
        }
      ],
      "mark": "bar",
      "encoding": {
        "opacity": {
          "condition": {"param": "mode_selection", "value": 1},
          "value": 0.2
        }
      }
    },
    {
      "transform": [
        {
          "aggregate": [{"op": "sum", "field": "Pax_daily", "as": "Total_Pax"}],
          "groupby": ["Year"]
        }
      ],
      "mark": {
        "type": "text",
        "align": "center",
        "baseline": "bottom",
        "dy": 5,
        "color": "black",
        "angle": -90,
        "dx": 30
      },
      "encoding": {
        "x": {"field": "Year", "type": "ordinal"},
        "y": {"field": "Total_Pax", "type": "quantitative"},
        "color": {"value": "black"},
        "text": {
          "field": "Total_Pax",
          "type": "quantitative",
          "format": "s" 
        }
      }
    }
  ]
}